- name: Install python
  become: yes
  apt:
    name:
      - python3
      - python3-pip
      - python3-dev
      - python3.8
      - python3.8-dev
      - python3.9
      - python3.9-dev
      - python3.10
      - python3.10-dev
      - python-is-python3
    state: present

- name: Check if poetry is installed
  stat:
    path: "{{ dotfiles_user_home }}/.poetry/bin/poetry"
  register: poetry_bin
  changed_when: false

- name: Install poetry
  when: not poetry_bin.stat.exists
  args:
    executable: /usr/bin/bash
  shell: |
    set -o pipefail &&
    curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -

- name: Install user python packages
  pip:
    name: "{{ pip_user_packages }}"
    state: present
    extra_args: --user
